<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consistency & Drawdown Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3616/3616786.png" />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(120deg, #101624 0%, #1e293b 100%);
      color: #f1f5f9;
      min-height: 100vh;
    }

    .glass-card {
      background: rgba(24, 32, 54, 0.85);
      border-radius: 1.5rem;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      padding: 2rem;
      margin-bottom: 2rem;
      transition: box-shadow 0.2s;
    }

    .glass-card:hover {
      box-shadow: 0 12px 40px 0 rgba(16, 185, 129, 0.15);
    }

    .accent {
      color: #34d399;
    }

    .btn {
      background: linear-gradient(90deg, #34d399 0%, #6366f1 100%);
      color: #fff;
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px 0 rgba(52, 211, 153, 0.08);
    }

    .btn:hover {
      background: linear-gradient(90deg, #6366f1 0%, #34d399 100%);
      transform: translateY(-2px) scale(1.03);
    }

    .input {
      background: rgba(30, 41, 59, 0.85);
      border: 1px solid #334155;
      color: #f1f5f9;
      border-radius: 0.75rem;
      padding: 0.6rem 1rem;
      width: 100%;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
    }

    .input:focus {
      border: 1.5px solid #34d399;
      box-shadow: 0 0 0 2px #34d39933;
    }

    .stat {
      background: rgba(39, 51, 89, 0.95);
      border-radius: 1rem;
      padding: 1.2rem 1rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .stat-title {
      color: #a5b4fc;
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .slide-in {
      animation: slideIn 0.5s cubic-bezier(.4, 2, .6, 1) both;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(24px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .table-dark {
      width: 100%;
      border-collapse: collapse;
    }

    .table-dark th,
    .table-dark td {
      padding: 0.7rem 1rem;
      border-bottom: 1px solid #334155;
    }

    .table-dark th {
      color: #a5b4fc;
      font-weight: 600;
      background: rgba(30, 41, 59, 0.7);
    }

    .table-dark tr:last-child td {
      border-bottom: none;
    }

    .remove-btn {
      color: #f87171;
      background: none;
      border: none;
      font-size: 1.1rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .remove-btn:hover {
      color: #ef4444;
    }

    .chart-container {
      background: rgba(30, 41, 59, 0.85);
      border-radius: 1.5rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .status-pass {
      color: #34d399;
      font-weight: 600;
    }

    .status-fail {
      color: #f87171;
      font-weight: 600;
    }

    /* Modernize number input arrows */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      background: none;
      margin: 0;
    }

    input[type=number] {
      appearance: textfield;
      background: rgba(30, 41, 59, 0.85);
      color: #f1f5f9;
      border: 1px solid #334155;
      border-radius: 0.75rem;
      padding: 0.6rem 1rem;
      width: 100%;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
    }

    input[type=number]:focus {
      border: 1.5px solid #34d399;
      box-shadow: 0 0 0 2px #34d39933;
    }

    /* Modern select dropdown */
    .modern-select {
      background: rgba(30, 41, 59, 0.95);
      color: #f1f5f9;
      border: 1px solid #334155;
      border-radius: 0.75rem;
      padding: 0.6rem 2.2rem 0.6rem 1rem;
      appearance: none;
      font-weight: 500;
      position: relative;
      min-width: 120px;
      transition: border 0.2s, box-shadow 0.2s;
    }

    .modern-select:focus {
      border: 1.5px solid #6366f1;
      box-shadow: 0 0 0 2px #6366f133;
    }

    .modern-select-wrapper {
      position: relative;
      display: inline-block;
    }

    .modern-select-wrapper::after {
      content: '\25BC';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #a5b4fc;
      pointer-events: none;
      font-size: 1rem;
    }

    /* Help button */
    .help-btn {
      background: linear-gradient(90deg, #6366f1 0%, #34d399 100%);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      margin-right: 0.5rem;
      cursor: pointer;
      box-shadow: 0 2px 8px 0 rgba(52, 211, 153, 0.08);
      transition: background 0.2s, transform 0.1s;
    }

    .help-btn:hover {
      background: linear-gradient(90deg, #34d399 0%, #6366f1 100%);
      transform: scale(1.08);
    }

    /* Modal styles */
    .modal-bg {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(16, 22, 36, 0.85);
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: rgba(30, 41, 59, 0.98);
      color: #f1f5f9;
      border-radius: 1.2rem;
      font-size: 0.75rem;
      /* ~12px */
      max-width: 520px;
      width: 98vw;
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
      position: relative;
      animation: slideIn 0.3s cubic-bezier(.4, 2, .6, 1) both;
    }

    .modal-content h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #a5b4fc;
    }

    .modal-content p,
    .modal-content ul,
    .modal-content li {
      font-size: 0.78rem;
      /* ~11-12px */
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: #f1f5f9;
      font-size: 1.3rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #34d399;
    }

    .floating-footnote {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      background: rgba(24, 32, 54, 0.97);
      color: #64748b;
      font-size: 0.78rem;
      opacity: 0.7;
      padding: 0.7rem 1.5rem 0.7rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      box-shadow: 0 -2px 16px 0 rgba(16, 22, 36, 0.12);
      border-top: 1px solid #334155;
      letter-spacing: 0.01em;
    }

    .floating-footnote .footer-center {
      flex: 1 1 0%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
    }

    .floating-footnote .footer-icons {
      display: flex;
      gap: 1.1rem;
      align-items: center;
      margin-right: 1.5rem;
    }

    .floating-footnote a {
      color: #64748b;
      font-size: 1.1rem;
      opacity: 0.8;
      transition: color 0.2s, opacity 0.2s;
      display: inline-flex;
      align-items: center;
    }

    .floating-footnote a:hover {
      color: #34d399;
      opacity: 1;
    }

    .floating-footnote .footer-actions {
      display: flex;
      gap: 0.5rem;
      margin-left: auto;
    }

    @media (max-width: 600px) {
      .floating-footnote {
        font-size: 0.92rem;
        padding: 0.6rem 0.5rem;
        flex-direction: column;
        gap: 0.5rem;
        align-items: stretch;
      }

      .floating-footnote .footer-center {
        align-items: center;
        justify-content: center;
        text-align: center;
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
      }

      .floating-footnote .footer-icons {
        justify-content: center;
        margin: 0 auto 0.3rem auto;
        display: flex;
      }

      .floating-footnote .footer-actions {
        justify-content: center;
        margin: 0.3rem auto 0 auto;
        display: flex;
      }
    }

    .subtitle-artistic {
      font-family: 'Roboto', sans-serif;
      font-size: 0.92rem;
      color: #94a3b8;
      margin-top: 0.25rem;
    }
  </style>
</head>

<body class="min-h-screen">
  <div id="app" class="container mx-auto px-2 sm:px-4 py-8 max-w-6xl"></div>

  <div id="helpModal" class="modal-bg" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" id="closeHelpModal" title="Close">&times;</button>
      <h2>Instructions</h2>
      <div id="helpModalContent"></div>
    </div>
  </div>

  <script>
    const { jsPDF } = window.jspdf;

    // Traductions
    const translations = {
      en: {
        title: "Prop Firm Performance Analyzer",
        settings: "Challenge Parameters",
        initialCapital: "Initial Capital ($)",
        targetProfit: "Target Profit ($)",
        consistencyPercent: "Consistency Rule (%)",
        minDayPercent: "Min % of Best Day",
        minProfitPerDay: "Min Profit/Day ($)",
        minTradingDays: "Min Trading Days",
        maxDrawdown: "Max Drawdown ($)",
        dailyLossLimit: "Daily Loss Limit ($)",
        dailyPnL: "Daily Performance",
        enterPnL: "Enter daily P&L ($)",
        add: "Add Day",
        results: "Performance Analysis",
        totalPnL: "Total P&L",
        bestDay: "Best Day",
        minRequiredDay: "Min Required/Day",
        optimalDailyPnL: "Optimal Daily Target",
        eligible: "✅ Challenge Passed!",
        notEligible: "❌ Challenge Failed",
        notEnoughDays: "Not enough trading days",
        bestDayExceeds: "Best day exceeds",
        daysBelowMin: "Some days below",
        daysBelowProfit: "Some days below min profit/day",
        drawdownViolated: "Drawdown limit violated",
        dailyLossViolated: "Daily loss limit violated",
        exportPDF: "Export Report",
        exportData: "Export Data",
        importData: "Import Data",
        language: "Language",
        accountBalance: "Account Balance",
        error: "An error occurred. Please check the console for details.",
        clearData: "Clear All Data",
        performanceChart: "Performance Trend",
        profitDays: "Profit Days",
        lossDays: "Loss Days",
        avgProfit: "Avg Profit/Day",
        avgLoss: "Avg Loss/Day",
        winRate: "Win Rate",
        maxConsecutiveWins: "Max Consecutive Wins",
        maxConsecutiveLosses: "Max Consecutive Losses",
        ignoreConsistency: "Ignore Consistency/Min%/Min Profit rules",
        helpText: "For any rule you want to ignore, enter 0 in the corresponding field. Only fields with a value greater than 0 will be enforced."
      },
      fr: {
        title: "Analyseur de Performance pour Prop Firms",
        settings: "Paramètres du Challenge",
        initialCapital: "Capital Initial ($)",
        targetProfit: "Objectif de Profit ($)",
        consistencyPercent: "Règle de Cohérence (%)",
        minDayPercent: "Min % du Meilleur Jour",
        minProfitPerDay: "Profit Min/Jour ($)",
        minTradingDays: "Jours de Trading Min",
        maxDrawdown: "Drawdown Max ($)",
        dailyLossLimit: "Limite de Perte Quotidienne ($)",
        dailyPnL: "Performance Quotidienne",
        enterPnL: "Entrez le P&L quotidien ($)",
        add: "Ajouter Jour",
        results: "Analyse de Performance",
        totalPnL: "P&L Total",
        bestDay: "Meilleur Jour",
        minRequiredDay: "Min Requis/Jour",
        optimalDailyPnL: "Objectif Quotidien Optimal",
        eligible: "✅ Challenge Réussi !",
        notEligible: "❌ Challenge Échoué",
        notEnoughDays: "Pas assez de jours de trading",
        bestDayExceeds: "Meilleur jour dépasse",
        daysBelowMin: "Certains jours sous",
        daysBelowProfit: "Certains jours sous le profit min/jour",
        drawdownViolated: "Limite de drawdown violée",
        dailyLossViolated: "Limite de perte quotidienne violée",
        exportPDF: "Exporter Rapport",
        exportData: "Exporter les données",
        importData: "Importer les données",
        language: "Langue",
        accountBalance: "Solde du Compte",
        error: "Une erreur s'est produite. Veuillez vérifier la console pour plus de détails.",
        clearData: "Effacer Toutes les Données",
        performanceChart: "Tendance de Performance",
        profitDays: "Jours de Profit",
        lossDays: "Jours de Perte",
        avgProfit: "Moyenne Profit/Jour",
        avgLoss: "Moyenne Perte/Jour",
        winRate: "Taux de Réussite",
        maxConsecutiveWins: "Gains Consécutifs Max",
        maxConsecutiveLosses: "Pertes Consécutives Max",
        ignoreConsistency: "Ignorer les règles de Cohérence/Min%/Profit Min",
        helpText: "Pour ignorer une règle, entrez 0 dans le champ correspondant. Seules les valeurs supérieures à 0 seront prises en compte."
      }
    };

    // Fonction pour calculer les statistiques avancées
    function calculateAdvancedStats(dailyPnLs) {
      const stats = {
        profitDays: 0,
        lossDays: 0,
        totalProfit: 0,
        totalLoss: 0,
        winStreak: 0,
        loseStreak: 0,
        maxWinStreak: 0,
        maxLoseStreak: 0,
        currentStreak: 0,
        previousType: null
      };

      dailyPnLs.forEach(pnL => {
        if (pnL >= 0) {
          stats.profitDays++;
          stats.totalProfit += pnL;

          if (stats.previousType === 'win' || stats.previousType === null) {
            stats.winStreak++;
          } else {
            stats.winStreak = 1;
          }
          stats.maxWinStreak = Math.max(stats.maxWinStreak, stats.winStreak);
          stats.previousType = 'win';
        } else {
          stats.lossDays++;
          stats.totalLoss += Math.abs(pnL);

          if (stats.previousType === 'loss' || stats.previousType === null) {
            stats.loseStreak++;
          } else {
            stats.loseStreak = 1;
          }
          stats.maxLoseStreak = Math.max(stats.maxLoseStreak, stats.loseStreak);
          stats.previousType = 'loss';
        }
      });

      return {
        profitDays: stats.profitDays,
        lossDays: stats.lossDays,
        avgProfit: stats.profitDays > 0 ? (stats.totalProfit / stats.profitDays) : 0,
        avgLoss: stats.lossDays > 0 ? (stats.totalLoss / stats.lossDays) : 0,
        winRate: dailyPnLs.length > 0 ? (stats.profitDays / dailyPnLs.length * 100) : 0,
        maxConsecutiveWins: stats.maxWinStreak,
        maxConsecutiveLosses: stats.maxLoseStreak
      };
    }

    // Composant principal
    class App {
      constructor() {
        this.state = {
          language: localStorage.getItem('language') || 'en',
          error: null,
          initialCapital: localStorage.getItem('initialCapital') || 50000,
          targetProfit: localStorage.getItem('targetProfit') || 10000,
          consistencyPercent: localStorage.getItem('consistencyPercent') || 40,
          minDayPercent: localStorage.getItem('minDayPercent') || 23,
          minProfitPerDay: localStorage.getItem('minProfitPerDay') || 200,
          minTradingDays: localStorage.getItem('minTradingDays') || 10,
          maxDrawdown: localStorage.getItem('maxDrawdown') || 2000,
          dailyLossLimit: localStorage.getItem('dailyLossLimit') || 1000,
          dailyPnLs: JSON.parse(localStorage.getItem('dailyPnLs')) || [],
          newPnL: ''
        };
        this.chartInstance = null;
        this.t = translations[this.state.language];
        this.init();
      }

      init() {
        this.render();
        this.initChart();
        this.bindEvents();
      }

      saveState() {
        try {
          localStorage.setItem('language', this.state.language);
          localStorage.setItem('initialCapital', this.state.initialCapital);
          localStorage.setItem('targetProfit', this.state.targetProfit);
          localStorage.setItem('consistencyPercent', this.state.consistencyPercent);
          localStorage.setItem('minDayPercent', this.state.minDayPercent);
          localStorage.setItem('minProfitPerDay', this.state.minProfitPerDay);
          localStorage.setItem('minTradingDays', this.state.minTradingDays);
          localStorage.setItem('maxDrawdown', this.state.maxDrawdown);
          localStorage.setItem('dailyLossLimit', this.state.dailyLossLimit);
          localStorage.setItem('dailyPnLs', JSON.stringify(this.state.dailyPnLs));
        } catch (err) {
          console.error('Failed to save to localStorage:', err);
          this.setState({ error: this.t.error });
        }
      }

      setState(newState) {
        this.state = { ...this.state, ...newState };
        this.t = translations[this.state.language];
        this.saveState();
        this.render();
        setTimeout(() => {
          if (!this.chartInstance && this.state.dailyPnLs.length > 0) {
            this.initChart();
          } else if (this.chartInstance) {
            this.updateChart();
          }
        }, 0);
      }

      calculateResults() {
        const {
          dailyPnLs,
          initialCapital,
          targetProfit,
          consistencyPercent,
          minDayPercent,
          minProfitPerDay,
          minTradingDays,
          maxDrawdown,
          dailyLossLimit
        } = this.state;

        const totalPnL = dailyPnLs.reduce((sum, pnL) => sum + Number(pnL), 0);
        const maxDayPnL = dailyPnLs.length > 0 ? Math.max(...dailyPnLs) : 0;
        const maxDayPercent = totalPnL > 0 ? (maxDayPnL / totalPnL) * 100 : 0;
        const minRequiredPerDay = (minDayPercent / 100) * maxDayPnL;
        const accountBalance = Number(initialCapital) + totalPnL;
        const drawdownViolated = maxDrawdown > 0 ? accountBalance < (initialCapital - maxDrawdown) : false;
        const dailyLossViolated = dailyLossLimit > 0 ? dailyPnLs.some(pnL => pnL < -dailyLossLimit) : false;
        // Only enforce rules if their value is >0
        const checkConsistency = consistencyPercent > 0 ? maxDayPercent <= consistencyPercent : true;
        const checkMinDay = minDayPercent > 0 ? dailyPnLs.filter(pnL => pnL > 0).every(pnL => pnL >= minRequiredPerDay) : true;
        const checkMinProfit = minProfitPerDay > 0 ? dailyPnLs.filter(pnL => pnL > 0).every(pnL => pnL >= minProfitPerDay) : true;
        const isEligible = dailyPnLs.length >= minTradingDays &&
          checkConsistency &&
          checkMinDay &&
          checkMinProfit &&
          !drawdownViolated &&
          !dailyLossViolated;
        const targetDiff = totalPnL < targetProfit ? targetProfit - totalPnL : 0;

        const optimalDailyPnL = dailyPnLs.length > 0
          ? (targetProfit / Math.max(dailyPnLs.length, minTradingDays)) * (100 / (100 - (consistencyPercent > 0 ? consistencyPercent : 0)))
          : targetProfit / minTradingDays;

        const advancedStats = calculateAdvancedStats(dailyPnLs);

        return {
          totalPnL,
          maxDayPnL,
          maxDayPercent,
          minRequiredPerDay,
          accountBalance,
          drawdownViolated,
          dailyLossViolated,
          isEligible,
          optimalDailyPnL,
          targetDiff,
          checkConsistency,
          checkMinDay,
          checkMinProfit,
          ...advancedStats
        };
      }

      addPnL() {
        try {
          // Always get the latest value from the input field
          const input = document.getElementById('newPnL');
          const value = input ? parseFloat(input.value) : parseFloat(this.state.newPnL);
          if (!isNaN(value)) {
            this.setState({
              dailyPnLs: [...this.state.dailyPnLs, value],
              newPnL: ''
            });
          }
        } catch (err) {
          console.error('Failed to add P&L:', err);
          this.setState({ error: this.t.error });
        }
      }

      removePnL(index) {
        try {
          this.setState({
            dailyPnLs: this.state.dailyPnLs.filter((_, i) => i !== index)
          });
        } catch (err) {
          console.error('Failed to remove P&L:', err);
          this.setState({ error: this.t.error });
        }
      }

      clearAllData() {
        if (confirm(this.state.language === 'fr' ? "Êtes-vous sûr de vouloir effacer toutes les données ?" : "Are you sure you want to clear all data?")) {
          this.setState({
            dailyPnLs: [],
            newPnL: ''
          });
        }
      }

      initChart() {
        const ctx = document.getElementById('performanceChart').getContext('2d');
        this.chartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: this.state.dailyPnLs.map((_, i) => `Day ${i + 1}`),
            datasets: [
              {
                label: this.t.performanceChart,
                data: this.state.dailyPnLs,
                borderColor: '#10b981',
                backgroundColor: 'rgba(16,185,129,0.15)', // always green fill
                borderWidth: 2,
                tension: 0.3,
                fill: true,
                pointBackgroundColor: this.state.dailyPnLs.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444'),
                pointBorderColor: '#fff',
                pointRadius: 4,
                pointHoverRadius: 6
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: '#1e293b',
                titleColor: '#f8fafc',
                bodyColor: '#e2e8f0',
                borderColor: '#334155',
                borderWidth: 1,
                callbacks: {
                  label: function (context) {
                    let label = '';
                    if (context.parsed.y !== null) {
                      label += (context.parsed.y >= 0 ? '+' : '') + '$ ' + context.parsed.y.toFixed(2);
                    }
                    return label;
                  }
                }
              }
            },
            scales: {
              x: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: { color: '#94a3b8' },
                title: { display: true, text: 'Trading Days', color: '#94a3b8' }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: '#94a3b8',
                  callback: function (value) { return '$ ' + value; }
                },
                title: { display: true, text: 'P&L ($)', color: '#94a3b8' }
              }
            },
            interaction: { mode: 'nearest', axis: 'x', intersect: false }
          }
        });
      }

      updateChart() {
        if (!this.chartInstance) return;
        const labels = this.state.dailyPnLs.map((_, i) => `Day ${i + 1}`);
        this.chartInstance.data.labels = labels;
        this.chartInstance.data.datasets[0].data = this.state.dailyPnLs;
        this.chartInstance.data.datasets[0].pointBackgroundColor = this.state.dailyPnLs.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444');
        this.chartInstance.update();
      }

      bindEvents() {
        // Attach listeners directly after each render
        const addBtn = document.getElementById('addPnL');
        const clearBtn = document.getElementById('clearData');
        const newPnLInput = document.getElementById('newPnL');
        const langSelect = document.getElementById('language');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeHelpModal = document.getElementById('closeHelpModal');
        const removeBtns = document.querySelectorAll('.remove-pnl');
        const inputIds = [
          'initialCapital', 'targetProfit', 'consistencyPercent', 'minDayPercent',
          'minProfitPerDay', 'minTradingDays', 'maxDrawdown', 'dailyLossLimit'
        ];

        if (addBtn) addBtn.onclick = () => this.addPnL();
        if (clearBtn) clearBtn.onclick = () => this.clearAllData();
        if (langSelect) langSelect.onchange = (e) => this.setState({ language: e.target.value });
        if (helpBtn && helpModal) {
          helpBtn.onclick = () => {
            const content = this.state.language === 'fr' ? `
              <p><b>À propos :</b><br>Cette application web vous aide à vérifier si vos performances de trading respectent les règles de consistance et de gestion du risque imposées par les prop firms. Elle permet de simuler, suivre et analyser vos résultats quotidiens pour maximiser vos chances de réussir un challenge ou d’obtenir un payout.</p>
              <p><b>Instructions :</b></p>
              <ul>
                <li>1. Renseignez les paramètres du challenge (capital initial, objectif, drawdown, etc.).</li>
                <li>2. Ajoutez chaque jour votre P&L (profit ou perte) dans le champ prévu puis cliquez sur “Ajouter Jour”.</li>
                <li>3. Consultez vos statistiques, l’éligibilité et le graphique de performance.</li>
                <li>4. Vous pouvez supprimer un jour, effacer toutes les données, exporter vos données au format JSON ou importer un fichier JSON pour restaurer vos données.</li>
                <li>5. Changez la langue avec le sélecteur en haut à droite.</li>
              </ul>
              <p><b>Import/Export :</b><br>Utilisez “Exporter les données” pour sauvegarder vos paramètres et performances au format JSON. Utilisez “Importer les données” pour charger un fichier JSON précédemment exporté et restaurer votre session.</p>
              <p><b>Stockage :</b><br>Vos données sont enregistrées localement dans votre navigateur (aucune transmission externe).</p>
            ` : `
              <p><b>About:</b><br>This web app helps you check if your trading performance meets the consistency and risk management rules required by prop firms. It lets you simulate, track, and analyze your daily results to maximize your chances of passing a challenge or getting a payout.</p>
              <p><b>Instructions:</b></p>
              <ul>
                <li>1. Fill in the challenge parameters (initial capital, target, drawdown, etc.).</li>
                <li>2. Add your daily P&L (profit or loss) in the input field and click “Add Day”.</li>
                <li>3. Review your stats, eligibility, and the performance chart.</li>
                <li>4. You can remove a day, clear all data, export your data as JSON, or import a JSON file to restore your session.</li>
                <li>5. Switch language using the selector at the top right.</li>
              </ul>
              <p><b>Import/Export:</b><br>Use “Export Data” to save your settings and performance as a JSON file. Use “Import Data” to load a previously exported JSON file and restore your session.</p>
              <p><b>Data Storage:</b><br>Your data is saved locally in your browser (never sent anywhere).</p>
            `;
            document.getElementById('helpModalContent').innerHTML = content;
            helpModal.style.display = 'flex';
          };
        }
        if (closeHelpModal && helpModal) closeHelpModal.onclick = () => { helpModal.style.display = 'none'; };
        if (helpModal) helpModal.onclick = (e) => { if (e.target === helpModal) helpModal.style.display = 'none'; };
        if (newPnLInput) {
          // Only update state on blur or Enter, not on every input
          newPnLInput.oninput = null;
          newPnLInput.onblur = (e) => this.setState({ newPnL: e.target.value });
          newPnLInput.onkeypress = (e) => { if (e.key === 'Enter') this.addPnL(); };
        }
        inputIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.onchange = (e) => this.setState({ [id]: e.target.value });
        });
        removeBtns.forEach(btn => {
          btn.onclick = (e) => {
            const idx = parseInt(btn.dataset.index);
            this.removePnL(idx);
          };
        });

        // Add import/export event listeners
        const importBtn = document.getElementById('importDataBtn');
        const importInput = document.getElementById('importData');
        const exportDataBtn = document.getElementById('exportDataBtn');
        if (importBtn && importInput) {
          importBtn.onclick = () => importInput.click();
          importInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                this.setState({ ...data });
              } catch (err) {
                alert('Invalid JSON file.');
              }
            };
            reader.readAsText(file);
          };
        }
        if (exportDataBtn) {
          exportDataBtn.onclick = () => {
            const data = {
              language: this.state.language,
              initialCapital: this.state.initialCapital,
              targetProfit: this.state.targetProfit,
              consistencyPercent: this.state.consistencyPercent,
              minDayPercent: this.state.minDayPercent,
              minProfitPerDay: this.state.minProfitPerDay,
              minTradingDays: this.state.minTradingDays,
              maxDrawdown: this.state.maxDrawdown,
              dailyLossLimit: this.state.dailyLossLimit,
              dailyPnLs: this.state.dailyPnLs
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'propfirm_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };
        }

        // Add import/export event listeners for footer
        const importBtnFooter = document.getElementById('importDataBtnFooter');
        const importInputFooter = document.getElementById('importDataFooter');
        const exportDataBtnFooter = document.getElementById('exportDataBtnFooter');
        if (importBtnFooter && importInputFooter) {
          importBtnFooter.onclick = () => importInputFooter.click();
          importInputFooter.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                this.setState({ ...data });
              } catch (err) {
                alert('Invalid JSON file.');
              }
            };
            reader.readAsText(file);
          };
        }
        if (exportDataBtnFooter) {
          exportDataBtnFooter.onclick = () => {
            const data = {
              language: this.state.language,
              initialCapital: this.state.initialCapital,
              targetProfit: this.state.targetProfit,
              consistencyPercent: this.state.consistencyPercent,
              minDayPercent: this.state.minDayPercent,
              minProfitPerDay: this.state.minProfitPerDay,
              minTradingDays: this.state.minTradingDays,
              maxDrawdown: this.state.maxDrawdown,
              dailyLossLimit: this.state.dailyLossLimit,
              dailyPnLs: this.state.dailyPnLs
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'propfirm_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };
        }
      }

      render() {
        const { t } = this;
        const results = this.calculateResults();

        document.getElementById('app').innerHTML = `
          <div class="space-y-8">
            <!-- Header -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
              <div class="flex flex-col">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-500 to-emerald-400 bg-clip-text text-transparent">
                  <i class="fas fa-chart-line mr-2"></i>${t.title}
                </h1>
                <p class="subtitle-artistic">${this.state.language === 'fr' ? 'Simulez et analysez vos performances de trading pour réussir n’importe quel challenge prop firm.' : 'Simulate and analyze your trading performance to pass any prop firm challenge.'}</p>
              </div>
              <div class="flex items-center gap-2 mt-2 sm:mt-0">
                <button id="helpBtn" class="help-btn" title="Help / Aide"><i class="fas fa-question"></i></button>
                <div class="modern-select-wrapper">
                  <select id="language" class="modern-select">
                    <option value="en" ${this.state.language === 'en' ? 'selected' : ''}>English</option>
                    <option value="fr" ${this.state.language === 'fr' ? 'selected' : ''}>Français</option>
                  </select>
                </div>
              </div>
            </div>
            
            ${this.state.error ? `
              <div class="bg-red-900/50 border border-red-700 text-red-100 p-4 rounded-lg">
                <i class="fas fa-exclamation-circle mr-2"></i>${this.state.error}
              </div>
            ` : ''}
            
            <!-- Settings Card -->
            <div class="card rounded-xl p-6 shadow-lg slide-in">
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-cog mr-2 text-blue-400"></i>${t.settings}
              </h2>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <!-- Initial Capital -->
                <div>
                  <label for="initialCapital" class="block text-sm font-medium text-slate-300 mb-1">${t.initialCapital}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="initialCapital" 
                      value="${this.state.initialCapital}"
                      placeholder=""
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                    />
                  </div>
                </div>
                
                <!-- Target Profit -->
                <div>
                  <label for="targetProfit" class="block text-sm font-medium text-slate-300 mb-1">${t.targetProfit}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="targetProfit" 
                      value="${this.state.targetProfit}"
                      placeholder=""
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                    />
                  </div>
                </div>
                
                <!-- Consistency Percent -->
                <div>
                  <label for="consistencyPercent" class="block text-sm font-medium text-slate-300 mb-1">${t.consistencyPercent}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="consistencyPercent" 
                      value="${this.state.consistencyPercent}"
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                      max="100"
                    />
                    <span class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400">%</span>
                  </div>
                </div>
                
                <!-- Min Day Percent -->
                <div>
                  <label for="minDayPercent" class="block text-sm font-medium text-slate-300 mb-1">${t.minDayPercent}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="minDayPercent" 
                      value="${this.state.minDayPercent}"
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                      max="100"
                    />
                    <span class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400">%</span>
                  </div>
                </div>
                
                <!-- Min Profit Per Day -->
                <div>
                  <label for="minProfitPerDay" class="block text-sm font-medium text-slate-300 mb-1">${t.minProfitPerDay}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="minProfitPerDay" 
                      value="${this.state.minProfitPerDay}"
                      placeholder=""
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                    />
                  </div>
                </div>
                
                <!-- Min Trading Days -->
                <div>
                  <label for="minTradingDays" class="block text-sm font-medium text-slate-300 mb-1">${t.minTradingDays}</label>
                  <input 
                    type="number" 
                    id="minTradingDays" 
                    value="${this.state.minTradingDays}"
                    class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    min="1"
                  />
                </div>
                
                <!-- Max Drawdown -->
                <div>
                  <label for="maxDrawdown" class="block text-sm font-medium text-slate-300 mb-1">${t.maxDrawdown}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="maxDrawdown" 
                      value="${this.state.maxDrawdown}" 
                      placeholder=""
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                    />
                  </div>
                </div>
                
                <!-- Daily Loss Limit -->
                <div>
                  <label for="dailyLossLimit" class="block text-sm font-medium text-slate-300 mb-1">${t.dailyLossLimit}</label>
                  <div class="relative">
                    <input 
                      type="number" 
                      id="dailyLossLimit" 
                      value="${this.state.dailyLossLimit}"
                      placeholder=""
                      class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      min="0"
                    />
                  </div>
                </div>
              </div>

              <!-- Help Text -->
              <div class="col-span-full text-xs text-slate-400 mt-2">
                ${t.helpText}
              </div>
            </div>
            
            <!-- Daily P&L Input -->
            <div class="card rounded-xl p-6 shadow-lg slide-in">
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-calendar-day mr-2 text-emerald-400"></i>${t.dailyPnL}
              </h2>
              
              <div class="flex flex-col sm:flex-row gap-3 mb-4">
                <div class="relative flex-1">
                  <input 
                    type="number" 
                    id="newPnL" 
                    value="${this.state.newPnL}"
                    placeholder="${t.enterPnL.replace(/\$/g, '').trim()}"
                    class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-6 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
                <button 
                  id="addPnL"
                  class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg transition flex items-center justify-center"
                >
                  <i class="fas fa-plus mr-2"></i>${t.add}
                </button>
                <button 
                  id="clearData"
                  class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-lg transition flex items-center justify-center"
                >
                  <i class="fas fa-trash-alt mr-2"></i>${t.clearData}
                </button>
              </div>
              
              <div class="max-h-60 overflow-y-auto scrollbar-hide border border-slate-700 rounded-lg">
                ${this.state.dailyPnLs.length > 0 ? `
                  <table class="min-w-full divide-y divide-slate-700">
                    <thead class="bg-slate-800">
                      <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Day</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">P&L</th>
                        <th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody class="bg-slate-800/50 divide-y divide-slate-700">
                      ${this.state.dailyPnLs.map((pnL, index) => `
                        <tr class="${pnL >= 0 ? 'text-emerald-300' : 'text-rose-400'}">
                          <td class="px-4 py-3 whitespace-nowrap">Day ${index + 1}</td>
                          <td class="px-4 py-3 whitespace-nowrap">${pnL !== 0 ? '$&nbsp;&nbsp;' : ''}${pnL.toFixed(2)}</td>
                          <td class="px-4 py-3 whitespace-nowrap text-right">
                            <button 
                              data-index="${index}"
                              class="remove-pnl text-slate-400 hover:text-rose-500 transition"
                            >
                              <i class="fas fa-times"></i>
                            </button>
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                ` : `
                  <div class="p-8 text-center text-slate-500">
                    <i class="fas fa-inbox text-4xl mb-2"></i>
                    <p>No trading days added yet</p>
                  </div>
                `}
              </div>
            </div>
            
            <!-- Performance Chart -->
            <div class="card rounded-xl p-6 shadow-lg slide-in">
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-chart-area mr-2 text-purple-400"></i>${t.performanceChart}
              </h2>
              <div class="h-80 overflow-x-auto">
                <canvas id="performanceChart"></canvas>
              </div>
            </div>
            
            <!-- Results Card -->
            <div class="card rounded-xl p-6 shadow-lg slide-in">
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-chart-pie mr-2 text-amber-400"></i>${t.results}
              </h2>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Basic Stats -->
                <div class="space-y-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.totalPnL}</p>
                      <p class="text-2xl font-semibold ${results.totalPnL >= 0 ? 'text-emerald-400' : 'text-rose-400'}">
                        ${results.totalPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.totalPnL.toFixed(2)}
                      </p>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.accountBalance}</p>
                      <p class="text-2xl font-semibold ${results.accountBalance >= this.state.initialCapital ? 'text-emerald-400' : 'text-rose-400'}">
                        ${results.accountBalance !== 0 ? '$&nbsp;&nbsp;' : ''}${results.accountBalance.toFixed(2)}
                      </p>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.bestDay}</p>
                      <p class="text-xl font-semibold text-emerald-400">
                        ${results.maxDayPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.maxDayPnL.toFixed(2)} <span class="text-sm">(${results.maxDayPercent.toFixed(2)}%)</span>
                      </p>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.minRequiredDay}</p>
                      <p class="text-xl font-semibold text-blue-400">
                        ${results.minRequiredPerDay !== 0 ? '$&nbsp;&nbsp;' : ''}${results.minRequiredPerDay.toFixed(2)}
                      </p>
                    </div>
                  </div>
                  
                  <div class="bg-slate-800/50 p-4 rounded-lg">
                    <p class="text-sm text-slate-400">${t.optimalDailyPnL}</p>
                    <p class="text-xl font-semibold text-purple-400">
                      ${results.optimalDailyPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.optimalDailyPnL.toFixed(2)}
                    </p>
                  </div>
                  
                  <div class="bg-slate-800/50 p-4 rounded-lg">
                    <p class="text-sm text-slate-400">Challenge Status</p>
                    ${this.state.dailyPnLs.length === 0 ? `
                      <p class="text-base text-slate-400 italic">Awaiting trading data…</p>
                    ` :
            !results.isEligible && this.state.dailyPnLs.length < this.state.minTradingDays && results.checkConsistency && results.checkMinDay && results.checkMinProfit && !results.drawdownViolated && !results.dailyLossViolated ? `
                        <div class="mb-2">
                          <div class="w-full bg-slate-700 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 via-emerald-400 to-yellow-300 h-3 rounded-full animate-pulse" style="width: ${(this.state.dailyPnLs.length / this.state.minTradingDays) * 100}%"></div>
                          </div>
                          <p class="mt-2 text-emerald-300 font-semibold">Keep going! ${this.state.dailyPnLs.length} of ${this.state.minTradingDays} trading days completed.</p>
                          <p class="text-xs text-slate-400">Stay consistent and reach the minimum to be eligible for payout.</p>
                        </div>
                      ` :
              results.isEligible ? `
                        <p class="text-xl font-semibold text-emerald-400">✅ Eligible for Payout</p>
                        ${results.targetDiff > 0 ? `<div class="mt-2 text-sm text-yellow-300"><i class="fas fa-exclamation-circle mr-1"></i>Target not reached: $&nbsp;&nbsp;${results.targetDiff.toFixed(2)} left</div>` : ''}
                      ` :
                `<p class="text-xl font-semibold text-rose-400">❌ Challenge Failed</p>`
          }
                    ${!results.isEligible && this.state.dailyPnLs.length > 0 ? `
                      <div class="mt-2 text-sm text-slate-300 space-y-1">
                        ${this.state.dailyPnLs.length < this.state.minTradingDays ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.notEnoughDays} (${this.state.dailyPnLs.length}/${this.state.minTradingDays})</p>
                        ` : ''}
                        ${results.maxDayPercent > this.state.consistencyPercent ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.bestDayExceeds} ${this.state.consistencyPercent}% (${results.maxDayPercent.toFixed(2)}%)</p>
                        ` : ''}
                        ${this.state.dailyPnLs.some(pnL => pnL < results.minRequiredPerDay) ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.daysBelowMin} ${this.state.minDayPercent}% of best day ($&nbsp;&nbsp;${results.minRequiredPerDay.toFixed(2)})</p>
                        ` : ''}
                        ${this.state.dailyPnLs.some(pnL => pnL < this.state.minProfitPerDay) ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.daysBelowProfit} ($&nbsp;&nbsp;${this.state.minProfitPerDay})</p>
                        ` : ''}
                        ${results.drawdownViolated ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.drawdownViolated} ($&nbsp;&nbsp;${this.state.maxDrawdown})</p>
                        ` : ''}
                        ${results.dailyLossViolated ? `
                          <p><i class="fas fa-times-circle text-rose-400 mr-1"></i> ${t.dailyLossViolated} ($&nbsp;&nbsp;${this.state.dailyLossLimit})</p>
                        ` : ''}
                      </div>
                    ` : ''}
                  </div>
                </div>
                
                <!-- Advanced Stats -->
                <div class="space-y-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.profitDays}</p>
                      <p class="text-2xl font-semibold text-emerald-400">
                        ${results.profitDays}
                      </p>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.lossDays}</p>
                      <p class="text-2xl font-semibold text-rose-400">
                        ${results.lossDays}
                      </p>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.avgProfit}</p>
                      <p class="text-xl font-semibold text-emerald-400">
                        ${results.avgProfit !== 0 ? '$&nbsp;&nbsp;' : ''}${results.avgProfit.toFixed(2)}
                      </p>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.avgLoss}</p>
                      <p class="text-xl font-semibold text-rose-400">
                        ${results.avgLoss !== 0 ? '$&nbsp;&nbsp;' : ''}${results.avgLoss.toFixed(2)}
                      </p>
                    </div>
                  </div>
                  
                  <div class="bg-slate-800/50 p-4 rounded-lg">
                    <p class="text-sm text-slate-400">${t.winRate}</p>
                    <div class="mt-1">
                      <div class="w-full bg-slate-700 rounded-full h-2.5">
                        <div 
                          class="bg-gradient-to-r from-blue-500 to-emerald-400 h-2.5 rounded-full" 
                          style="width: ${results.winRate}%"
                        ></div>
                      </div>
                      <p class="text-xl font-semibold text-blue-400 mt-1">
                        ${results.winRate.toFixed(2)}%
                      </p>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.maxConsecutiveWins}</p>
                      <p class="text-xl font-semibold text-emerald-400">
                        ${results.maxConsecutiveWins}
                      </p>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg">
                      <p class="text-sm text-slate-400">${t.maxConsecutiveLosses}</p>
                      <p class="text-xl font-semibold text-rose-400">
                        ${results.maxConsecutiveLosses}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        // Destroy and re-initialize the chart after each render
        if (this.chartInstance) {
          this.chartInstance.destroy();
          this.chartInstance = null;
        }
        if (this.state.dailyPnLs.length > 0) {
          this.initChart();
        }
        this.bindEvents();
      }
    }

    // Initialiser l'application
    document.addEventListener('DOMContentLoaded', () => {
      new App();
    });
  </script>

  <div class="floating-footnote">
    <span class="footer-icons mt-1" style="margin-right:1.5rem;">
      <a href="https://discord.com/" target="_blank" title="Discord"><i class="fab fa-discord"></i></a>
      <a href="https://twitter.com/" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="https://youtube.com/" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
      <a href="https://wa.me/" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
    </span>
    <div class="footer-center">
      Designed by Traders, for Traders &copy; 2025 • Powered by 3dr!ves
    </div>
    <span class="footer-actions flex gap-2 ml-auto" style="margin-left:auto;">
      <input type="file" id="importDataFooter" accept="application/json" style="display:none;" />
      <button id="importDataBtnFooter"
        class="bg-slate-700 hover:bg-slate-800 text-white px-4 py-1.5 rounded-lg flex items-center text-sm border border-slate-600">
        <i class="fas fa-file-import mr-2"></i>Import Data
      </button>
      <button id="exportDataBtnFooter"
        class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-1.5 rounded-lg flex items-center text-sm border border-blue-600">
        <i class="fas fa-file-export mr-2"></i>Export Data
      </button>
    </span>
  </div>
</body>

</html>